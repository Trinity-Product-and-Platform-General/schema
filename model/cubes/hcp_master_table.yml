cubes :
  - name: hcp_data
    sql_table: MASTER_TABLE.HCP_MASTER_TABLE_V1
    public: false

    dimensions:
      - name: hcp_id
        sql: hcp_id
        type: string
        primary_key : true
        
      - name: hcp_name
        sql: physician_name
        type: string
        
      - name: organisation_id
        sql: hco_affiliation_id
        type: string
 
      - name: organisation_name
        sql: hco_affiliation_name
        type: string
    
      - name: brand_name
        sql: brand
        type: string

      - name: region_id
        sql: region_id
        type: string
    
      - name: region_name
        sql: region
        type: string

      - name: territory
        sql: "CONCAT ({CUBE}.territory, ' (' , {CUBE}.territory_id , ')' )"
        type: string

      - name: zip_code
        sql: zip
        type: number
        
      - name: address
        sql: address
        type: string
    
      - name: state
        sql: city_state
        type: string

      - name: city
        sql: city
        type: string
    
      - name: target_segment
        sql: segment
        type: string

      - name: payer
        sql : payer
        type : string

      - name: market
        sql : market
        type : string
  
      - name: channel_type
        sql: channel
        type: string

      - name: last_shipment_date
        sql: last_shipment_date
        type: time

      - name: last_call_date
        sql: last_call_date
        type: time

      - name: date
        sql: "COALESCE({CUBE}.last_shipment_date,{CUBE}.last_call_date)"
        type: time

      - name: engagement_type
        sql: engagement_type
        type: string

      - name: trx_flag
        sql: trx_flag
        type: number

      - name: nrx_flag
        sql: nrx_flag
        type: number

      - name: nbrx_flag
        sql: nbrx_flag
        type: number

      - name: ic_eligible_flag
        sql: ic_eligible
        type: string

      - name: demand_flag
        sql: is_demand_flag
        type: string

      - name: pdrp_flag
        sql: pdrp
        type: string
    
      - name: target
        sql: is_target
        type: string

      - name: top_growth_2022
        sql: top_growth_2022
        type: string
        
      - name : hcps_current_year_flag
        sql : HCP_current_year
        type : string

      - name: hcps_current_quarter_flag
        sql : HCP_current_quarter
        type : string

  ############ date at different levels ######################

      - name: year_date
        sql: "EXTRACT(year FROM cast({date} as date))"
        type: string

      - name: month_date
        sql: "CONCAT_WS('-', EXTRACT(year FROM cast({date} as date)), LPAD(CAST(EXTRACT(month FROM cast({date} as date)) AS STRING), 2, '0'))" 
        type: string

      - name: quarter_date
        sql : "
         CONCAT_WS ('-',EXTRACT(year FROM cast({date} as date)) ,
         CASE WHEN CAST(EXTRACT(month FROM cast({date} as date)) AS int) BETWEEN 1 AND 3 THEN 'Q1'
         WHEN CAST(EXTRACT(month FROM cast({date} as date)) AS int) BETWEEN 4 AND 6 THEN 'Q2'
         WHEN CAST(EXTRACT(month FROM cast({date} as date)) AS int) BETWEEN 7 AND 9 THEN 'Q3'
         WHEN CAST(EXTRACT(month FROM cast({date} as date)) AS int) BETWEEN 10 AND 12 THEN 'Q4'
         ELSE NULL
         END)"
        type: string

  #######################
    measures:
      - name: count
        type: count
        
      - name: hcp_count
        sql: hcp_id
        type: count_distinct

      - name: call_count
        sql: engagement_id
        type: count_distinct

      - name: total_sales
        sql: |
          (select sum(Quantity_normalized) from PROCESSING_LAYER_DB.MASTER_TABLE.HCP_MASTER_TABLE_v1)
        type: max

      - name: total_hcp_count
        sql: |
          (select count(DISTINCT hcp_id) from PROCESSING_LAYER_DB.MASTER_TABLE.HCP_MASTER_TABLE_v1)
        type: max


###################### sales #################################
      - name: current_week_sales
        sql: "sum(CASE WHEN {CUBE}.CURRENT_WEEK = 1 then {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_week_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_WEEK = 1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: current_week_sales_growth_percentage
        sql : "case when {previous_week_sales}=0 and {current_week_sales}=0 then 0 when {current_week_sales}=0 then -100 when {previous_week_sales}=0 then 100 else (round((({current_week_sales}-{previous_week_sales})/{previous_week_sales})*100,2)) END"
        type: number

      - name: current_12_month_sales
        sql: "sum(CASE WHEN {CUBE}.CURRENT_12_MONTHS=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_12_month_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_12_MONTHS=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: twelve_month_sales_growth_percentage
        sql : "case when {previous_12_month_sales}=0 and {current_12_month_sales}=0 then 0 when {current_12_month_sales}=0 then -100 when {previous_12_month_sales}=0 then 100 else (round((({current_12_month_sales}-{previous_12_month_sales})/{previous_12_month_sales})*100,2)) END"
        type: number

      - name: current_year_to_date_sales
        sql: "sum(CASE WHEN {CUBE}.YEAR_TO_DATE=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number
        
      - name: previous_year_to_date_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_YEAR_TO_DATE=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: year_to_date_sales_growth_percentage
        sql : "case when {previous_year_to_date_sales}=0 and {current_year_to_date_sales}=0 then 0 when {current_year_to_date_sales}=0 then -100 when {previous_year_to_date_sales}=0 then 100 else (round((({current_year_to_date_sales}-{previous_year_to_date_sales})/{previous_year_to_date_sales})*100,2)) END"
        type: number

      - name: current_quarter_to_date_sales
        sql: "sum(CASE WHEN {CUBE}.QUARTER_TO_DATE= 1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_quarter_to_date_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_QUARTER_TO_DATE=1  THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: quarter_to_date_sales_growth_percentage
        sql : "case when {previous_quarter_to_date_sales}=0 and {current_quarter_to_date_sales}=0 then 0 when {current_quarter_to_date_sales}=0 then -100 when {previous_quarter_to_date_sales}=0 then 100 else (round((({current_quarter_to_date_sales}-{previous_quarter_to_date_sales})/{previous_quarter_to_date_sales})*100,2)) END"
        type: number

      - name: current_13_week_sales
        sql: "sum(CASE WHEN {CUBE}.CURRENT_13_WEEK=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_13_week_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_13_WEEK=1  THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: thirteen_week_sales_growth_percentage
        sql : "case when {previous_13_week_sales}=0 and {current_13_week_sales}=0 then 0 when {current_13_week_sales}=0 then -100 when {previous_13_week_sales}=0 then 100 else (round((({current_13_week_sales}-{previous_13_week_sales})/{previous_13_week_sales})*100,2)) END"
        type: number

      - name: current_4_week_sales
        sql: "sum(CASE WHEN {CUBE}.CURRENT_4_WEEK=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_4_week_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_4_WEEK=1  THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: four_week_sales_growth_percentage
        sql : "case when {previous_4_week_sales}=0 and {current_4_week_sales}=0 then 0 when {current_4_week_sales}=0 then -100 when {previous_4_week_sales}=0 then 100 else (round((({current_4_week_sales}-{previous_4_week_sales})/{previous_4_week_sales})*100,2)) END"
        type: number

      - name: current_8_week_sales
        sql: "sum(CASE WHEN {CUBE}.CURRENT_8_WEEK=1 THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: previous_8_week_sales
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_8_WEEK=1  THEN {CUBE}.Quantity_normalized ELSE 0 END)"
        type: number

      - name: eight_week_sales_growth_percentage
        sql : "case when {previous_8_week_sales}=0 and {current_8_week_sales}=0 then 0 when {current_8_week_sales}=0 then -100 when {previous_8_week_sales}=0 then 100 else (round((({current_8_week_sales}-{previous_8_week_sales})/{previous_8_week_sales})*100,2)) END"
        type: number

      - name: current_week_calls
        sql: "count(distinct CASE WHEN CURRENT_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: previous_week_calls
        sql: "count(distinct CASE WHEN PREVIOUS_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: current_week_calls_growth_percentage
        sql : "case when {previous_week_calls}=0 and {current_week_calls}=0 then 0 when {current_week_calls}=0 then -100 when {previous_week_calls}=0 then 100 else (round((({current_week_calls}-{previous_week_calls})/{previous_week_calls})*100,2)) END"
        type: number

      - name: current_year_to_date_calls
        sql: "count( distinct CASE WHEN {CUBE}.YEAR_TO_DATE= 1 THEN {CUBE}.engagement_id END)"
        type: number

      - name: previous_year_to_date_calls
        sql: "count(distinct CASE WHEN PREVIOUS_YEAR_TO_DATE=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: year_to_date_calls_growth_percentage
        sql : "case when {previous_year_to_date_calls}=0 and {current_year_to_date_calls}=0 then 0 when {current_year_to_date_calls}=0 then -100 when {previous_year_to_date_calls}=0 then 100 else (round((({current_year_to_date_calls}-{previous_year_to_date_calls})/{previous_year_to_date_calls})*100,2)) END"
        type: number

      - name: current_quarter_to_date_calls
        sql: "count(distinct CASE WHEN {CUBE}.QUARTER_TO_DATE= 1 THEN {CUBE}.engagement_id END)"
        type: number

      - name: previous_quarter_to_date_calls
        sql: "count(distinct CASE WHEN PREVIOUS_QUARTER_TO_DATE=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: quarter_to_date_calls_growth_percentage
        sql : "case when {previous_quarter_to_date_calls}=0 and {current_quarter_to_date_calls}=0 then 0 when {current_quarter_to_date_calls}=0 then -100 when {previous_quarter_to_date_calls}=0 then 100 else (round((({current_quarter_to_date_calls}-{previous_quarter_to_date_calls})/{previous_quarter_to_date_calls})*100,2)) END"
        type: number

      - name: current_13_week_calls
        sql: "count(distinct CASE WHEN CURRENT_13_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: previous_13_week_calls
        sql: "count(distinct CASE WHEN PREVIOUS_13_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: thirteen_week_calls_growth_percentage
        sql : "case when {previous_13_week_calls}=0 and {current_13_week_calls}=0 then 0 when {current_13_week_calls}=0 then -100 when {previous_13_week_calls}=0 then 100 else (round((({current_13_week_calls}-{previous_13_week_calls})/{previous_13_week_calls})*100,2)) END"
        type: number

      - name: current_12_month_calls
        sql: "count(distinct CASE WHEN CURRENT_12_MONTHS=1 THEN {CUBE}.engagement_id END)"
        type: number

      - name: previous_12_month_calls
        sql: "count(distinct CASE WHEN PREVIOUS_12_MONTHS=1 THEN {CUBE}.engagement_id END)"
        type: number


      - name: twelve_month_calls_growth_percentage
        sql : "case when {previous_12_month_calls}=0 and {current_12_month_calls}=0 then 0  when {current_12_month_calls}=0 then -100 when {previous_12_month_calls}=0 then 100 else (round((({current_12_month_calls}-{previous_12_month_calls})/{previous_12_month_calls})*100,2)) END"
        type: number

      - name: current_4_week_calls
        sql: "count(distinct CASE WHEN CURRENT_4_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: previous_4_week_calls
        sql: "count(distinct CASE WHEN PREVIOUS_4_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number
        
      - name: four_week_calls_growth_percentage
        sql : "case when {previous_4_week_calls}=0 and {current_4_week_calls}=0 then 0 when {current_4_week_calls}=0 then -100 when {previous_4_week_calls}=0 then 100 else (round((({current_4_week_calls}-{previous_4_week_calls})/{previous_4_week_calls})*100,2)) END"
        type: number
		
      - name: current_8_week_calls
        sql: "count(distinct CASE WHEN CURRENT_8_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number

      - name: previous_8_week_calls
        sql: "count(distinct CASE WHEN PREVIOUS_8_WEEK=1 THEN  {CUBE}.engagement_id END)"
        type: number
        
      - name: eight_week_calls_growth_percentage
        sql : "case when {previous_8_week_calls}=0 and {current_8_week_calls}=0 then 0 when {current_8_week_calls}=0 then -100 when {previous_8_week_calls}=0 then 100 else (round((({current_8_week_calls}-{previous_8_week_calls})/{previous_8_week_calls})*100,2)) END"
        type: number

##################### ADDITIONAL KPI ##################################        
##################### hcp count distribution ###########################
      - name: current_week_hcp_count
        sql: "count(distinct CASE WHEN CURRENT_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_week_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_12_month_hcp_count
        sql: "count(distinct CASE WHEN CURRENT_12_MONTHS=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_12_month_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_12_MONTHS=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_year_to_date_hcp_count
        sql: "count(distinct CASE WHEN YEAR_TO_DATE=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_year_to_date_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_YEAR_TO_DATE=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_quarter_to_date_hcp_count
        sql: "count(distinct CASE WHEN QUARTER_TO_DATE=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_quarter_to_date_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_QUARTER_TO_DATE=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_13_week_hcp_count
        sql: "count(distinct CASE WHEN CURRENT_13_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_13_week_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_13_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_4_week_hcp_count
        sql: "count(distinct CASE WHEN CURRENT_4_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_4_week_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_4_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: current_8_week_hcp_count
        sql: "count(distinct CASE WHEN CURRENT_8_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number

      - name: previous_8_week_hcp_count
        sql: "count(distinct CASE WHEN PREVIOUS_8_WEEK=1 THEN  {CUBE}.hcp_id END)"
        type: number


########################### hcp growth ###########################

      - name: current_week_hcp_growth_percentage
        sql : "case when {previous_week_hcp_count}=0 and {current_week_hcp_count}=0 then 0 when {current_week_hcp_count}=0 then -100 when {previous_week_hcp_count}=0 then 100 else (round((({current_week_hcp_count}-{previous_week_hcp_count})/{previous_week_hcp_count})*100,2)) END"
        type: number

      - name: twelve_month_hcp_growth_percentage
        sql : "case when {previous_12_month_hcp_count}=0 and {current_12_month_hcp_count}=0 then 0 when {current_12_month_hcp_count}=0 then -100 when {previous_12_month_hcp_count}=0 then 100 else (round((({current_12_month_hcp_count}-{previous_12_month_hcp_count})/{previous_12_month_hcp_count})*100,2)) END"
        type: number

      - name: year_to_date_hcp_growth_percentage
        sql : "case when {previous_year_to_date_hcp_count}=0 and {current_year_to_date_hcp_count}=0 then 0 when {current_year_to_date_hcp_count}=0 then -100 when {previous_year_to_date_hcp_count}=0 then 100 else (round((({current_year_to_date_hcp_count}-{previous_year_to_date_hcp_count})/{previous_year_to_date_hcp_count})*100,2)) END"
        type: number

      - name: quarter_to_date_hcp_growth_percentage
        sql : "case when {previous_quarter_to_date_hcp_count}=0 and {current_quarter_to_date_hcp_count}=0 then 0 when {current_quarter_to_date_hcp_count}=0 then -100 when {previous_quarter_to_date_hcp_count}=0 then 100 else (round((({current_quarter_to_date_hcp_count}-{previous_quarter_to_date_hcp_count})/{previous_quarter_to_date_hcp_count})*100,2)) END"
        type: number

      - name: thirteen_week_hcp_growth_percentage
        sql : "case when {previous_13_week_hcp_count}=0 and {current_13_week_hcp_count}=0 then 0 when {current_13_week_hcp_count}=0 then -100 when {previous_13_week_hcp_count}=0 then 100 else (round((({current_13_week_hcp_count}-{previous_13_week_hcp_count})/{previous_13_week_hcp_count})*100,2)) END"
        type: number

      - name: four_week_hcp_growth_percentage
        sql : "case when {previous_4_week_hcp_count}=0 and {current_4_week_hcp_count}=0 then 0 when {current_4_week_hcp_count}=0 then -100 when {previous_4_week_hcp_count}=0 then 100 else (round((({current_4_week_hcp_count}-{previous_4_week_hcp_count})/{previous_4_week_hcp_count})*100,2)) END"
        type: number

      - name: eight_week_hcp_growth_percentage
        sql : "case when {previous_8_week_hcp_count}=0 and {current_8_week_hcp_count}=0 then 0 when {current_8_week_hcp_count}=0 then -100 when {previous_8_week_hcp_count}=0 then 100 else (round((({current_8_week_hcp_count}-{previous_8_week_hcp_count})/{previous_8_week_hcp_count})*100,2)) END"
        type: number     


#################### depth timebucket ################

      - name: sales_per_hcp
        sql : "DIV0({total_sales},{hcp_count})"
        type: number

      - name: current_week_sales_per_hcp
        sql : "DIV0({current_week_sales},{current_week_hcp_count})"
        type: number

      - name: previous_week_sales_per_hcp
        sql : "DIV0({previous_week_sales},{previous_week_hcp_count})"
        type: number

      - name: current_12_month_sales_per_hcp
        sql: "DIV0({current_12_month_sales},{current_12_month_hcp_count})"
        type: number
      
      - name: previous_12_month_sales_per_hcp
        sql: "DIV0({previous_12_month_sales},{previous_12_month_hcp_count})"
        type: number
      
      - name: current_year_to_date_sales_per_hcp
        sql: "DIV0({current_year_to_date_sales},{current_year_to_date_hcp_count})"
        type: number
      
      - name: previous_year_to_date_sales_per_hcp
        sql: "DIV0({previous_year_to_date_sales},{previous_year_to_date_hcp_count})"
        type: number
      
      - name: current_quarter_to_date_sales_per_hcp
        sql: "DIV0({current_quarter_to_date_sales},{current_quarter_to_date_hcp_count})"
        type: number
      
      - name: previous_quarter_to_date_sales_per_hcp
        sql: "DIV0({previous_quarter_to_date_sales},{previous_quarter_to_date_hcp_count})"
        type: number
      
      - name: current_13_week_sales_per_hcp
        sql: "DIV0({current_13_week_sales},{current_13_week_hcp_count})"
        type: number
      
      - name: previous_13_week_sales_per_hcp
        sql: "DIV0({previous_13_week_sales},{previous_13_week_hcp_count})"
        type: number
      
      - name: current_4_week_sales_per_hcp
        sql: "DIV0({current_4_week_sales},{current_4_week_hcp_count})"
        type: number
      
      - name: previous_4_week_sales_per_hcp
        sql: "DIV0({previous_4_week_sales},{previous_4_week_hcp_count})"
        type: number
      
      - name: current_8_week_sales_per_hcp
        sql: "DIV0({current_8_week_sales},{current_8_week_hcp_count})"
        type: number
      
      - name: previous_8_week_sales_per_hcp
        sql: "DIV0({previous_8_week_sales},{previous_8_week_hcp_count})"
        type: number

######################## Frequency #####################
      - name: calls_per_hcp
        sql : "DIV0({call_count},{hcp_count})"
        type: number

      - name: current_week_calls_per_hcp
        sql: "DIV0({current_week_calls},{current_week_hcp_count})"
        type: number
      
      - name: previous_week_calls_per_hcp
        sql: "DIV0({previous_week_calls},{previous_week_hcp_count})"
        type: number
      
      - name: current_12_month_calls_per_hcp
        sql: "DIV0({current_12_month_calls},{current_12_month_hcp_count})"
        type: number
      
      - name: previous_12_month_calls_per_hcp
        sql: "DIV0({previous_12_month_calls},{previous_12_month_hcp_count})"
        type: number
      
      - name: current_year_to_date_calls_per_hcp
        sql: "DIV0({current_year_to_date_calls},{current_year_to_date_hcp_count})"
        type: number
      
      - name: previous_year_to_date_calls_per_hcp
        sql: "DIV0({previous_year_to_date_calls},{previous_year_to_date_hcp_count})"
        type: number
      
      - name: current_quarter_to_date_calls_per_hcp
        sql: "DIV0({current_quarter_to_date_calls},{current_quarter_to_date_hcp_count})"
        type: number
      
      - name: previous_quarter_to_date_calls_per_hcp
        sql: "DIV0({previous_quarter_to_date_calls},{previous_quarter_to_date_hcp_count})"
        type: number
      
      - name: current_13_week_calls_per_hcp
        sql: "DIV0({current_13_week_calls},{current_13_week_hcp_count})"
        type: number
      
      - name: previous_13_week_calls_per_hcp
        sql: "DIV0({previous_13_week_calls},{previous_13_week_hcp_count})"
        type: number
      
      - name: current_4_week_calls_per_hcp
        sql: "DIV0({current_4_week_calls},{current_4_week_hcp_count})"
        type: number
      
      - name: previous_4_week_calls_per_hcp
        sql: "DIV0({previous_4_week_calls},{previous_4_week_hcp_count})"
        type: number
      
      - name: current_8_week_calls_per_hcp
        sql: "DIV0({current_8_week_calls},{current_8_week_hcp_count})"
        type: number
      
      - name: previous_8_week_calls_per_hcp
        sql: "DIV0({previous_8_week_calls},{previous_8_week_hcp_count})"
        type: number

###################### trx distribution ###############
      - name: current_week_sales_percentage
        sql : "({current_week_sales}/{total_sales})*100"
        type: number

      - name: previous_week_sales_percentage
        sql : "({previous_week_sales}/{total_sales})*100"
        type: number

      - name: current_12_month_sales_percentage
        sql: "({current_12_month_sales}/{total_sales})*100"
        type: number
      
      - name: previous_12_month_sales_percentage
        sql: "({previous_12_month_sales}/{total_sales})*100"
        type: number
      
      - name: current_year_to_date_sales_percentage
        sql: "({current_year_to_date_sales}/{total_sales}*100"
        type: number
      
      - name: previous_year_to_date_sales_percentage
        sql: "({previous_year_to_date_sales}/{total_sales})*100"
        type: number
      
      - name: current_quarter_to_date_sales_percentage
        sql: "({current_quarter_to_date_sales}/{total_sales})*100"
        type: number
      
      - name: previous_quarter_to_date_sales_percentage
        sql: "({previous_quarter_to_date_sales}/{total_sales})*100"
        type: number
      
      - name: current_13_week_sales_percentage
        sql: "({current_13_week_sales}/{total_sales})*100"
        type: number
      
      - name: previous_13_week_sales_percentage
        sql: "({previous_13_week_sales}/{total_sales})*100"
        type: number
      
      - name: current_4_week_sales_percentage
        sql: "({current_4_week_sales}/{total_sales})*100"
        type: number
      
      - name: previous_4_week_sales_percentage
        sql: "({previous_4_week_sales}/{total_sales})*100"
        type: number
      
      - name: current_8_week_sales_percentage
        sql: "({current_8_week_sales}/{total_sales})*100"
        type: number
      
      - name: previous_8_week_sales_percentage
        sql: "({previous_8_week_sales}/{total_sales}) * 100"
        type: number


######################### hcp reach #########################
      - name: current_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.CURRENT_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number

      - name: previous_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: current_12_month_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.CURRENT_12_MONTH=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_12_month_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_12_MONTH=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: current_year_to_date_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.YEAR_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_year_to_date_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_YEAR_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: current_quarter_to_date_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.QUARTER_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_quarter_to_date_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_QUARTER_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: current_13_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.CURRENT_13_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_13_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_13_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: current_4_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.CURRENT_4_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_4_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_4_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number

      - name: current_8_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.CURRENT_8_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number
      
      - name: previous_8_week_hcp_reach_count
        sql: "count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_8_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)"
        type: number


######################## hcp reach % #######################
      - name: current_week_hcp_reach_percentage 
        sql: "(count(DISTINCT CASE WHEN {CUBE}.CURRENT_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number

      - name: previous_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: current_12_month_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.CURRENT_12_MONTH=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_12_month_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_12_MONTH=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: current_year_to_date_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.YEAR_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_year_to_date_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_YEAR_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: current_quarter_to_date_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.QUARTER_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_quarter_to_date_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_QUARTER_TO_DATE=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: current_13_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.CURRENT_13_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_13_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_13_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: current_4_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.CURRENT_4_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_4_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_4_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number

      - name: current_8_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.CURRENT_8_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number
      
      - name: previous_8_week_hcp_reach_percentage
        sql: "(count(DISTINCT CASE WHEN {CUBE}.PREVIOUS_8_WEEK=1 and {CUBE}.ENGAGEMENT_ID is not null then hcp_id END)/{total_hcp_count}) * 100"
        type: number

        
################################ Call Goals ################################
      - name: current_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_WEEK = 1 then {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_WEEK = 1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_12_month_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_12_MONTHS=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_12_month_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_12_MONTHS=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_year_to_date_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.YEAR_TO_DATE=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number
        
      - name: previous_year_to_date_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_YEAR_TO_DATE=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_quarter_to_date_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.QUARTER_TO_DATE= 1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_quarter_to_date_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_QUARTER_TO_DATE=1  THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_13_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_13_WEEK=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_13_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_13_WEEK=1  THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_4_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_4_WEEK=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_4_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_4_WEEK=1  THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: current_8_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_8_WEEK=1 THEN {CUBE}.call_goal ELSE 0 END)"
        type: number

      - name: previous_8_week_calls_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_8_WEEK=1  THEN {CUBE}.call_goal ELSE 0 END)"
        type: number
      

################################## Sales Goals  ###################################
      - name: current_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_WEEK = 1 then {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_WEEK = 1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_12_month_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_12_MONTHS=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_12_month_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_12_MONTHS=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_year_to_date_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.YEAR_TO_DATE=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number
        
      - name: previous_year_to_date_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_YEAR_TO_DATE=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_quarter_to_date_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.QUARTER_TO_DATE= 1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_quarter_to_date_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_QUARTER_TO_DATE=1  THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_13_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_13_WEEK=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_13_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_13_WEEK=1  THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_4_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_4_WEEK=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_4_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_4_WEEK=1  THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: current_8_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.CURRENT_8_WEEK=1 THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number

      - name: previous_8_week_sales_attainment
        sql: "sum(CASE WHEN {CUBE}.PREVIOUS_8_WEEK=1  THEN {CUBE}.sales_goal ELSE 0 END)"
        type: number